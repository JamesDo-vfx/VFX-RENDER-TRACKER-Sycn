<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>VFX Machine Render Tracker - JamesDo ZodiacII</title>
    <style>
        :root { 
            --accent: #50fa7b; --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; 
            --shot-bg: #252525; --input-bg: #1a1a1a; --delete: #ff5555;
            --sync: #bd93f9; --eta-color: #f1fa8c;
        }
        
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); padding: 30px; margin: 0; }
        .container { max-width: 1550px; margin: 0 auto; }
        
        .main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: var(--card); padding: 20px 40px; border-radius: 16px; border: 1px solid #333; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { color: var(--accent); margin: 0; font-size: 24px; text-transform: uppercase; letter-spacing: 2px; }
        .author-name { color: var(--accent); font-weight: bold; }

        .shot-container { background: var(--card); border-radius: 24px; padding: 30px; margin-bottom: 50px; border: 1px solid #333; position: relative; }
        .shot-header { display: flex; flex-wrap: wrap; gap: 25px; align-items: flex-end; margin-bottom: 25px; }
        
        .timeline-wrapper { position: relative; margin-bottom: 40px; }
        .timeline-labels { display: flex; justify-content: space-between; color: #666; font-size: 11px; margin-bottom: 5px; font-family: monospace; }
        .timeline-box { width: 100%; height: 50px; background: #111; border-radius: 8px; position: relative; overflow: hidden; border: 1px solid #333; }
        
        .worker-block { position: absolute; height: 100%; top: 0; border-left: 1px solid rgba(255,255,255,0.1); border-right: 1px solid rgba(255,255,255,0.1); box-sizing: border-box; }
        .worker-fill { position: absolute; left: 0; top: 0; height: 100%; opacity: 0.4; transition: width 0.3s; }
        .worker-label-min { position: absolute; width:100%; text-align:center; top: 18px; font-size: 10px; font-weight: bold; color: #fff; text-shadow: 1px 1px 2px #000; z-index: 2; pointer-events: none; overflow: hidden; white-space: nowrap; }

        .worker-row { 
            display: grid; 
            grid-template-columns: 1.2fr 0.8fr 0.8fr 1fr 1.5fr 1.2fr; 
            gap: 15px; background: var(--shot-bg); padding: 15px; margin-bottom: 12px; 
            border-radius: 12px; align-items: center; border-left: 5px solid;
        }

        .input-group { display: flex; flex-direction: column; gap: 5px; }
        .input-group label { font-size: 9px; color: #777; text-transform: uppercase; font-weight: bold; }
        input { background: var(--input-bg); border: 1px solid #333; color: #fff; padding: 10px; border-radius: 6px; font-size: 14px; width: 100%; box-sizing: border-box; }

        .eta-display { text-align: center; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; border: 1px solid #333; }
        .eta-time { color: var(--eta-color); font-weight: bold; font-size: 15px; font-family: monospace; display: block; }
        .prog-percent { color: var(--accent); font-weight: bold; font-size: 13px; }

        .status-badge { font-size: 10px; color: var(--accent); font-weight: bold; display: flex; align-items: center; gap: 5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="main-header">
        <h1>VFX Render Machine Tracker</h1>
        <div class="author-info"><span class="author-name">JamesDo ZodiacII</span></div>
    </div>

    <div style="margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center;">
        <div class="status-badge">üõ∞Ô∏è Live Syncing from Firebase</div>
        <button style="background:transparent; color:#444; text-decoration: underline; font-size: 11px; cursor: pointer; border: none;" onclick="window.clearFirebase()">Clear Database</button>
    </div>

    <div id="shotList"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

    // --- C·∫§U H√åNH FIREBASE ---
    const firebaseConfig = {
        databaseURL: "https://vfx-machine-tracker-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const colors = ['#ff79c6', '#8be9fd', '#50fa7b', '#f1fa8c', '#bd93f9', '#ffb86c'];

    // L·∫Øng nghe d·ªØ li·ªáu
    onValue(ref(db, 'renders'), (snapshot) => {
        const data = snapshot.val();
        renderUI(data);
    });

    window.clearFirebase = () => {
        if(confirm("X√≥a to√†n b·ªô d·ªØ li·ªáu render tr√™n Firebase?")) {
            remove(ref(db, 'renders'));
        }
    };

    function renderUI(data) {
        const list = document.getElementById('shotList');
        list.innerHTML = '';
        if (!data) return;

        // Nh√≥m theo Shot
        const shots = {};
        Object.keys(data).forEach((key, index) => {
            const w = data[key];
            if (!shots[w.shotName]) {
                shots[w.shotName] = {
                    name: w.shotName,
                    gStart: w.globalStart,
                    gEnd: w.globalEnd,
                    workers: []
                };
            }
            shots[w.shotName].workers.push({ ...w, color: colors[index % colors.length] });
        });

        Object.values(shots).forEach(shot => {
            const workersHtml = shot.workers.map(w => `
                <div class="worker-row" style="border-left-color:${w.color}">
                    <div class="input-group"><label>Worker Name</label><input type="text" value="${w.workerName}" readonly></div>
                    <div class="input-group"><label>Start Frame (ROP)</label><input type="number" value="${w.startFrame}" readonly></div>
                    <div class="input-group"><label>End Frame (ROP)</label><input type="number" value="${w.endFrame}" readonly></div>
                    <div class="input-group"><label>Current Frame</label><input type="number" value="${w.currentFrame}" style="border: 1px solid var(--accent)" readonly></div>
                    <div class="input-group"><label>Node ($OS)</label><input type="text" value="${w.nodeOS}" readonly></div>
                    <div class="eta-display">
                        <span class="eta-time">${w.eta}</span>
                        <span class="prog-percent">${w.progress}%</span>
                    </div>
                </div>
            `).join('');

            const shotEl = document.createElement('div');
            shotEl.className = 'shot-container';
            shotEl.innerHTML = `
                <div class="shot-header">
                    <div class="input-group"><label>Shot Name</label><input type="text" style="color:var(--accent); font-weight:bold; font-size:18px" value="${shot.name}" readonly></div>
                    <div class="input-group"><label>Global Start</label><input type="number" style="width:100px" value="${shot.gStart}" readonly></div>
                    <div class="input-group"><label>Global End</label><input type="number" style="width:100px" value="${shot.gEnd}" readonly></div>
                    <div style="flex-grow: 1; text-align: right;">
                        <span style="color: var(--accent); font-size: 11px; font-weight: bold;">STATUS: ACTIVE</span>
                    </div>
                </div>
                <div class="timeline-wrapper">
                    <div class="timeline-labels"><span>${shot.gStart}</span><span>GLOBAL TIMELINE</span><span>${shot.gEnd}</span></div>
                    <div class="timeline-box">
                        ${shot.workers.map(w => {
                            const totalGlobal = shot.gEnd - shot.gStart;
                            const offset = ((w.startFrame - shot.gStart) / totalGlobal) * 100;
                            const width = ((w.endFrame - w.startFrame) / totalGlobal) * 100;
                            return `
                                <div class="worker-block" style="left:${offset}%; width:${width}%; background: rgba(255,255,255,0.05);">
                                    <div class="worker-fill" style="width:${w.progress}%; background-color:${w.color};"></div>
                                    <div class="worker-label-min">${w.workerName}</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
                <div>${workersHtml}</div>
            `;
            list.appendChild(shotEl);
        });
    }
</script>
</body>
</html>
